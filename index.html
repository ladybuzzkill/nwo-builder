<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NWO Character Builder (2d6)</title>
<style>
  :root { --bg:#0f1115; --card:#151923; --ink:#e6e8ee; --muted:#9aa3b2; --accent:#70a5ff; --good:#36d399; --bad:#ff6b6b; }
  html,body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.45 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  h1{font-size:22px;margin:0 0 12px}
  h2{font-size:16px;margin:24px 0 8px;color:var(--accent)}
  .grid{display:grid;gap:12px}
  @media (min-width: 960px){.grid{grid-template-columns: 1.2fr 1fr}}
  .card{background:var(--card);border:1px solid #232838;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
  .card h3{margin:0 0 8px;font-size:15px;color:var(--ink)}
  .card .hd{padding:12px 14px;border-bottom:1px solid #22293a;font-weight:600}
  .card .bd{padding:14px}
  label{display:block;margin:8px 0 4px;color:var(--muted)}
  select, input[type="number"], button{background:#0d111a;color:var(--ink);border:1px solid #2a3244;border-radius:10px;padding:10px 12px}
  select, input[type="number"]{width:100%}
  .row{display:grid;grid-template-columns: 1fr 1fr;gap:8px}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid #273046;background:#0d111a;border-radius:999px;margin:4px 6px 0 0}
  .muted{color:var(--muted)}
  .totals{display:flex;flex-wrap:wrap;gap:8px}
  .totals .pill b{color:var(--ink)}
  .section{margin-top:8px}
  .flex{display:flex;gap:10px;flex-wrap:wrap}
  .tag{font-size:12px;background:#0b1220;border:1px solid #22304a;border-radius:8px;padding:4px 8px;margin:2px 2px;color:var(--muted)}
  details{background:#0e1320;border:1px solid #232c40;border-radius:10px;padding:8px 10px}
  summary{cursor:pointer}
  .warning{color:var(--bad)}
  .success{color:var(--good)}
  .rollbox{display:flex;align-items:center;gap:10px;margin-top:10px}
  .dice{display:inline-grid;grid-template-columns:repeat(2,40px);gap:6px}
  .die{width:40px;height:40px;border-radius:8px;display:grid;place-items:center;background:#0b1020;border:1px solid #2a3350;font-weight:700}
  .total{font-size:18px;font-weight:700}
  .small{font-size:12px;color:var(--muted)}
  .list{display:grid;grid-template-columns: repeat(auto-fit,minmax(180px,1fr));gap:8px;margin-top:6px}
  .checkbox{display:flex;align-items:center;gap:8px;border:1px solid #2a3244;padding:8px;border-radius:10px}
  .checkbox input{width:16px;height:16px}
  .kudos{font-size:12px;color:var(--muted);margin-top:8px}
  .stat-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
  .stat-table th, .stat-table td { padding: 6px 8px; border-bottom: 1px solid #22293a; text-align: left; }
  .stat-table th { background: #171c26; position: sticky; top: 0; z-index: 1; color: var(--accent); }
  .note { font-size: 13px; color: var(--muted); background: #151923; border: 1px solid #232c40; border-radius: 8px; padding: 10px; margin-bottom: 8px; }
</style>
</head>
<body>
<div class="wrap">
  <h1>NWO Character Builder (2d6)</h1>
  <p class="muted">Pick a Background, add Traits & Skill Traits, then test 2d6 rolls with the live modifier. Built for the No Way Out dice rules.</p>
  <div class="grid">
    <div class="card">
      <div class="hd">1) Background, Trait Points & Selections</div>
      <div class="bd" id="bg-area"></div>
    </div>
    <div class="card">
      <div class="hd">2) 2d6 Test Roller</div>
      <div class="bd" id="roller-area"></div>
    </div>
  </div>

  <div class="grid" style="margin-top:12px">
    <div class="card">
      <div class="hd">3) Traits & Skills</div>
      <div class="bd" id="traits-area"></div>
    </div>
    <div class="card">
      <div class="hd">4) Build Summary & Modifiers</div>
      <div class="bd" id="summary-area"></div>
    </div>
  </div>

  <p class="kudos">Rules referenced from the NWO <em>Dice Guide</em>. <a href="https://www.no-way-out.com/wiki/Dice_Guide" target="_blank" style="color:var(--accent)">See the Dice Guide</a> for background traits, vanilla trait effects, and skill trait tiers.</p>
</div>

<script>
// --- Data from Dice Guide ---
const BACKGROUNDS = {
  Scavenger: {
    traitPoints: 8, base: { STR: 8, FIT: 8 },
    freeTraits: [
      { name: "Outdoorsman", effects: {} },
      { name: "Keen Hearing", effects: { Perception: +2 } }
    ]
  },
  Thinker: {
    traitPoints: 10, base: { STR: 8, FIT: 8 },
    freeTraits: [
      { name: "Dextrous", effects: {} },
      { name: "Fast Learner", effects: {} }
    ]
  },
  Stalwart: {
    traitPoints: 8, base: { STR: 10, FIT: 10 },
    freeTraits: [
      { name: "Fast Coagulation", effects: {} },
      { name: "Thick Skinned", effects: { Robustness: +2 } }
    ]
  },
  Labourer: {
    traitPoints: 8, base: { STR: 8, FIT: 8 },
    freeTraits: [
      { name: "Heavy Lifter", effects: { Robustness: +1 } },
      { name: "Organized", effects: {} }
    ]
  }
};

// --- POSITIVE TRAITS (updated per user) ---
const POSITIVE_TRAITS = [
  { name: "Speed Demon", cost: 1, effects: {} },
  { name: "Low Thirst", cost: 1, effects: {} },
  { name: "Herbalist", cost: 1, effects: {} },
  { name: "Iron Gut", cost: 1, effects: { Robustness: +1 } },
  { name: "Cats Eyes", cost: 2, effects: { Perception: +2 } },
  { name: "Adrenaline Junkie", cost: 2, effects: { Initiative: +2 } },
  { name: "Graceful", cost: 2, effects: { Stealth: +2 } },
  { name: "Brave", cost: 2, effects: { Resolve: +2 } },
  { name: "Inconspicuous", cost: 2, effects: { Stealth: +2 } },
  { name: "Fast Healer", cost: 2, effects: { Robustness: +1 } },
  { name: "Eagle Eyed", cost: 3, effects: { "Ranged Attack": +1, Perception: +2 } },
  { name: "Desensitized", cost: 4, effects: { Resolve: +4 } },
  { name: "Resilient", cost: 2, effects: { Robustness: +1 } },
  { name: "Fit", cost: 3, effects: { Fitness: +2 } },
  { name: "Strong", cost: 3, effects: { Strength: +2 } }
];

// --- NEGATIVE TRAITS (updated per user) ---
const NEGATIVE_TRAITS = [
  { name: "Prone to Illness", cost: 1, effects: { Robustness: -1 } },
  { name: "Smoker", cost: 1, effects: { Robustness: -1 } },
  { name: "Slow Driver", cost: 1, effects: {} },
  { name: "Slow Learner", cost: 1, effects: {} },
  { name: "Weak Stomach", cost: 1, effects: { Robustness: -1 } },
  { name: "Fear of Blood", cost: 2, effects: { Resolve: -2 } },
  { name: "Agoraphobic", cost: 2, effects: { Resolve: -2 } },
  { name: "Claustrophobic", cost: 2, effects: { Resolve: -2 } },
  { name: "Cowardly", cost: 2, effects: { Resolve: -2 } },
  { name: "Pacifist", cost: 2, effects: { Initiative: -2 } },
  { name: "Short Sighted", cost: 2, effects: { "Ranged Attack": -1, Perception: -1 } },
  { name: "Thin Skinned", cost: 2, effects: { Robustness: -2 } },
  { name: "Conspicuous", cost: 2, effects: { Stealth: -2 } },
  { name: "Clumsy", cost: 2, effects: { Stealth: -2 } },
  { name: "Hard of Hearing", cost: 2, effects: { Perception: -2 } },
  { name: "Deaf", cost: 4, effects: { Perception: -4 } },
  { name: "All Thumbs", cost: 2, effects: {} },
  { name: "Disorganized", cost: 3, effects: {} },
  { name: "Weak", cost: 3, effects: {} },
  { name: "Unfit", cost: 3, effects: {} },
  { name: "Illiterate", cost: 4, effects: {} },
  { name: "Slow Healer", cost: 1, effects: { Robustness: -1 } }
];

// --- Skill Traits ---
const SKILL_TIERS = {
  Amateur: { cost: 1, start: 6, cap: 6, limitPerChar: Infinity },
  Experienced: { cost: 2, start: 8, cap: 8, limitPerChar: 2 },
  Expert: { cost: 3, start: 10, cap: 10, limitPerChar: 1 },
};

const SKILL_GROUPS = [
  { key: "First Aid", label: "First Aid", list: ["First Aid"] },
  { key: "Aiming", label: "Aiming", list: ["Aiming"] },
  { key: "Reloading", label: "Reloading", list: ["Reloading"] },
  { key: "Nimble", label: "Nimble", list: ["Nimble"] },
  { key: "Sneaking", label: "Sneaking", list: ["Sneaking"] }
];

const SKILL_TO_CHECK = {
  Aiming: "Ranged Attack",
  Reloading: "Reloading",
  Sneaking: "Stealth",
  Nimble: "Nimble",
  FirstAid: "First Aid"
};

const CHECKS = [
  "Melee Attack", "Melee Defence", "Ranged Attack", "Reloading",
  "Perception", "Resolve", "Stealth", "Initiative", "Robustness",
  "First Aid", "Nimble", "Strength", "Fitness"
];

// --- State ---
const state = {
  background: "Scavenger",
  pos: new Set(),
  neg: new Set(),
  skills: {}, // key -> tier ("Amateur"/"Experienced"/"Expert")
};

// --- Helper Functions ---
function sumEffects() {
  const totals = {};
  CHECKS.forEach(c => totals[c] = 0);

  // Base STR/FIT from background
  const bg = BACKGROUNDS[state.background];
  totals.Strength = bg.base.STR;
  totals.Fitness = bg.base.FIT;

  // Background freebies
  for (const t of bg.freeTraits) {
    for (const [k, v] of Object.entries(t.effects)) totals[k] = (totals[k]||0)+v;
  }
  // Positives
  POSITIVE_TRAITS.forEach(t => {
    if (state.pos.has(t.name)) {
      for (const [k,v] of Object.entries(t.effects)) {
        if (k === "Strength" || k === "Fitness") totals[k] = (totals[k]||0)+v;
        else totals[k]=(totals[k]||0)+v;
      }
    }
  });
  // Negatives
  NEGATIVE_TRAITS.forEach(t => {
    if (state.neg.has(t.name)) {
      for (const [k,v] of Object.entries(t.effects)) {
        if (k === "Strength" || k === "Fitness") totals[k] = (totals[k]||0)+v;
        else totals[k]=(totals[k]||0)+v;
      }
    }
  });

  // Skills
  for (const [groupKey, tier] of Object.entries(state.skills)) {
    const group = SKILL_GROUPS.find(g => g.key === groupKey);
    if (!group) continue;
    const { start } = SKILL_TIERS[tier];
    const mod = Math.floor(start / 2);
    group.list.forEach(skill => {
      const check = SKILL_TO_CHECK[skill] ?? null;
      if (check) totals[check] = (totals[check]||0) + mod;
    });
  }

  // Derived Melee Attack/Defence mods from Strength
  if (typeof totals.Strength === "number") {
    if (totals.Strength <= 4) {
      totals["Melee Attack"] += -1;
      totals["Melee Defence"] += -1;
    } else if (totals.Strength <= 6) {
      // 6: no mod
    } else if (totals.Strength <= 8) {
      totals["Melee Attack"] += 1;
      totals["Melee Defence"] += 1;
    } else if (totals.Strength >= 10) {
      totals["Melee Attack"] += 2;
      totals["Melee Defence"] += 2;
    }
  }

  return totals;
}

function spend() {
  let pts = BACKGROUNDS[state.background].traitPoints;
  POSITIVE_TRAITS.forEach(t => { if (state.pos.has(t.name)) pts -= t.cost; });
  NEGATIVE_TRAITS.forEach(t => { if (state.neg.has(t.name)) pts += t.cost; });
  for (const tier of Object.values(state.skills)) pts -= SKILL_TIERS[tier].cost;
  return pts;
}

function skillTierCounts() {
  let exp=0, ex=0;
  for (const tier of Object.values(state.skills)) {
    if (tier==="Experienced") exp++;
    if (tier==="Expert") ex++;
  }
  return { exp, ex };
}

function calcMaxHP(fit) {
  if (fit >= 10) return 6;
  if (fit >= 8) return 5;
  if (fit >= 6) return 4;
  if (fit >= 4) return 3;
  return 2;
}

// --- Render Functions ---
function renderBackground() {
  const bg = BACKGROUNDS[state.background];
  let html = `
    <label>Background</label>
    <select id="backgroundSel">${Object.keys(BACKGROUNDS).map(k=>`<option value="${k}"${state.background===k?' selected':''}>${k}</option>`).join('')}</select>
    <div class="totals section">
      <span class="pill">Trait Points: <b>${bg.traitPoints}</b></span>
      <span class="pill">Base STR: <b>${bg.base.STR}</b></span>
      <span class="pill">Base FIT: <b>${bg.base.FIT}</b></span>
      ${bg.freeTraits.map(t=>`<span class="pill">${t.name}</span>`).join('')}
    </div>
    <div class="muted section">Background grants trait points, base STR/FIT, and unique thematic traits (applied automatically where relevant).</div>
    <div class="totals section">
      <span class="pill">Trait Points Used: <b>${bg.traitPoints-spend()}</b></span>
      <span class="pill ${spend()<0?'warning':'success'}">Remaining: <b>${spend()}</b></span>
    </div>
  `;
  document.getElementById('bg-area').innerHTML = html;
  document.getElementById('backgroundSel').onchange = e => {
    state.background = e.target.value;
    renderAll();
  };
}

function renderTraitsAndSkills() {
  // Positive traits
  let html = `<details open>
    <summary><strong>Positive Traits</strong> <span class="small">(costs subtract from your points)</span></summary>
    <div class="list" id="positives"></div>
  </details>
  <details open style="margin-top:12px">
    <summary><strong>Negative Traits</strong> <span class="small">(refund points)</span></summary>
    <div class="list" id="negatives"></div>
  </details>
  <div class="section" style="margin-top:12px">
    <strong>Skill Traits</strong>
    <div class="small">Amateur (1 pt, L6 cap), Experienced (2 pts, L8 cap, max 2), Expert (3 pts, L10 cap, max 1). Skill modifier = ⌊level ÷ 2⌋.</div>
    <div id="skills"></div>
    <div class="totals section">
      <span class="pill">Experienced: <b>${skillTierCounts().exp}/2</b></span>
      <span class="pill">Expert: <b>${skillTierCounts().ex}/1</b></span>
    </div>
  </div>`;
  document.getElementById('traits-area').innerHTML = html;

  // Positives
  document.getElementById('positives').innerHTML = POSITIVE_TRAITS.map(t=>{
    const id = `pos_${t.name.replace(/\s+/g,'_')}`;
    const checked = state.pos.has(t.name) ? 'checked' : '';
    const mods = Object.entries(t.effects).map(([k,v])=>`<span class="tag">${k}: ${v>0?'+':''}${v}</span>`).join('');
    return `<label class="checkbox"><input type="checkbox" id="${id}" ${checked}/> <div><b>${t.name}</b> <span class="muted">(cost ${t.cost})</span><div class="flex">${mods}</div></div></label>`;
  }).join('');
  POSITIVE_TRAITS.forEach(t=>{
    const id = `pos_${t.name.replace(/\s+/g,'_')}`;
    document.getElementById(id).onchange = (e)=>{
      e.target.checked ? state.pos.add(t.name) : state.pos.delete(t.name);
      renderAll();
    };
  });

  // Negatives
  document.getElementById('negatives').innerHTML = NEGATIVE_TRAITS.map(t=>{
    const id = `neg_${t.name.replace(/\s+/g,'_')}`;
    const checked = state.neg.has(t.name) ? 'checked' : '';
    const mods = Object.entries(t.effects).map(([k,v])=>`<span class="tag">${k}: ${v>0?'+':''}${v}</span>`).join('');
    return `<label class="checkbox"><input type="checkbox" id="${id}" ${checked}/> <div><b>${t.name}</b> <span class="muted">(refund ${t.cost})</span><div class="flex">${mods}</div></div></label>`;
  }).join('');
  NEGATIVE_TRAITS.forEach(t=>{
    const id = `neg_${t.name.replace(/\s+/g,'_')}`;
    document.getElementById(id).onchange = (e)=>{
      e.target.checked ? state.neg.add(t.name) : state.neg.delete(t.name);
      renderAll();
    };
  });

  // Skills
  document.getElementById('skills').innerHTML = SKILL_GROUPS.map(s=>{
    const val = state.skills[s.key] || '';
    const opts = ['','Amateur','Experienced','Expert'].map(tier=>{
      if(tier==='Experienced' && skillTierCounts().exp>=2 && val!==tier) return `<option disabled>Experienced (max 2)</option>`;
      if(tier==='Expert' && skillTierCounts().ex>=1 && val!==tier) return `<option disabled>Expert (max 1)</option>`;
      const lab = tier?`${tier} — cost ${SKILL_TIERS[tier]?.cost||''}, start L${SKILL_TIERS[tier]?.start||''}, cap ${SKILL_TIERS[tier]?.cap||''}`:'None';
      return `<option ${val===tier?'selected':''} value="${tier}">${lab}</option>`;
    }).join('');
    return `<div class="row" style="align-items:center;margin:6px 0">
      <div><b>${s.label}</b></div>
      <div><select id="skill_${s.key}">${opts}</select></div>
      <div class="small" style="grid-column: 1 / -1; color:var(--muted)">Level: <b>${val?SKILL_TIERS[val].start:0}</b> • Modifier: <b>${val?Math.floor(SKILL_TIERS[val].start/2):0}</b></div>
    </div>`;
  }).join('');
  SKILL_GROUPS.forEach(s=>{
    document.getElementById('skill_'+s.key).onchange = (e)=>{
      const v = e.target.value || null;
      if(v) state.skills[s.key]=v;
      else delete state.skills[s.key];
      renderAll();
    };
  });
}

function renderSummary() {
  const totals = sumEffects();
  let html = `<div class="note">Skill modifiers are computed as <b>(Skill Level ÷ 2)</b>. For example, Level 6 → +3; Level 10 → +5. <br>
    <b>Fitness</b> increases Max HP. <b>Strength</b> modifies Melee Attack & Defence per Dice Guide.<br>
    Background freebies and vanilla traits also add flat bonuses as listed.</div>
    <table class="stat-table"><thead>
      <tr><th>Stat/Check</th><th>Value/Mod</th></tr>
    </thead><tbody>`;
  html += `<tr><td>Strength</td><td>${totals.Strength||0}</td></tr>`;
  html += `<tr><td>Fitness</td><td>${totals.Fitness||0} (Max HP: ${calcMaxHP(totals.Fitness||0)})</td></tr>`;
  html += `<tr><td>Melee Attack Modifier</td><td>${totals["Melee Attack"]||0}</td></tr>`;
  html += `<tr><td>Melee Defence Modifier</td><td>${totals["Melee Defence"]||0}</td></tr>`;

  // Render other dice checks
  ["Ranged Attack","Reloading","Perception","Resolve","Stealth","Initiative","Robustness","First Aid","Nimble"].forEach(check=>{
    html += `<tr><td>${check}</td><td>${totals[check]||0}</td></tr>`;
  });

  html += `</tbody></table>`;
  document.getElementById('summary-area').innerHTML = html;
}

function renderRoller() {
  let html = `<label>Roll Test Type</label>
    <select id="rollType">${["Melee Attack","Melee Defence","Ranged Attack","Reloading","Perception","Resolve","Stealth","Initiative","Robustness","First Aid","Nimble"].map(k=>`<option>${k}</option>`).join('')}</select>
    <div class="rollbox">
      <button id="rollBtn">Roll 2d6</button>
      <div class="dice"><div class="die" id="d1">–</div><div class="die" id="d2">–</div></div>
      <div>
        <div class="total" id="total">Total —</div>
        <div class="small" id="breakdown">Modifier breakdown will appear here.</div>
      </div>
    </div>`;
  document.getElementById('roller-area').innerHTML = html;

  document.getElementById('rollBtn').onclick = ()=>{
    const name = document.getElementById('rollType').value;
    const [a,b] = [1+Math.floor(Math.random()*6), 1+Math.floor(Math.random()*6)];
    const totals = sumEffects();
    const mod = totals[name]||0;
    const total = a+b+mod;
    document.getElementById('d1').textContent = a;
    document.getElementById('d2').textContent = b;
    document.getElementById('total').textContent = `Total ${total}  (2d6=${a+b} ${mod>=0?'+':''}${mod})`;
    document.getElementById('breakdown').textContent = `Trait mods + Skill mods + Strength/Fitness rules (see summary)`;
  };
}

function renderAll() {
  renderBackground();
  renderTraitsAndSkills();
  renderSummary();
  renderRoller();
}

// --- init ---
renderAll();
</script>
</body>
</html>
